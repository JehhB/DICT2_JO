{% extends 'base.twig' %}
{% block head %}
<title>DICT JO - Dashboard</title>
{% endblock %}
{% block header %}
{% include 'nav-bar.twig' %}
{% endblock %}
{% block body %}
{% set is_admin = app.request.attributes.get('_route') == 'admin_joborders' %}
{% set current_route = app.request.attributes.get('_route') %}
{% set query = app.request.query.all %}

<div class="container mt-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item active" aria-current="page">Home</li>
    </ol>
  </nav>
</div>

<div class="container">
  <div class="row align-items-center justify-content-between gap-2">
    <em class="col-12 col-md-auto">
      {% if jobOrders.totalItemCount > 0 %}
        Showing page {{ jobOrders.currentPageNumber }} of {{ jobOrders.totalItemCount }}
      {% else %}
        Nothing Found.
      {% endif %}
    </em>
    <div class="d-flex justify-content-start align-items-center col-12 col-md-auto gap-2">
      <a
        href="/form.php"
        class="btn btn-sm btn-primary d-flex align-items-center gap-1"
      >
        <span class="hidden sm:block">add</span>
        <i class="fa-solid fa-plus"></i>
      </a>
      <div class="dropdown">
        <button class="btn btn-sm btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
          Filter
        </button>
        <div class="dropdown-menu">
          <a
            class="dropdown-item"
            href="{{ path(current_route, query | merge({sort: 'date_asc'})) }}"
          >
            Date Ascending
          </a>
          <a
            class="dropdown-item"
            href="{{ path(current_route, query | merge({sort: 'date_desc'})) }}"
          >
            Date Descending
          </a>
          <a
            class="dropdown-item"
            href="{{ path(current_route, query | merge({sort: 'issued_by'})) }}"
          >
            Issued By
          </a>
          <a
            class="dropdown-item"
            href="{{ path(current_route, query | merge({sort: 'approved_by'})) }}"
          >
            Approved By
          </a>
        </div>
      </div>
      <form action="dashboard.php" method="GET" class="input-group">
        <input class="form-control form-control-sm" type="text" name="search_query" placeholder="Search...">
        <button
          type="submit"
          class="btn btn-sm btn-success"
        >
          Search
        </button>
      </form>
      <a
        href="{{ path(app.request.attributes.get('_route')) }}"
        class="btn btn-sm btn-danger d-flex align-items-center gap-1"
      >
        <span class="hidden sm:block">Clear</span>
        <i class="fa-solid fa-broom"></i>
      </a>
    </div>
  </div>
</div>

<div class="container mt-5">
  <div class="col table-responsive mx-auto">
    <table class="table-light table-striped table border">
      <thead>
        <tr>
          <th>Job Order Number</th>
          {% if is_admin %}
            <th>Performed By</th>
          {% endif %}
          <th>Name</th>
          <th>Date</th>
          <th>Scheduled Date</th>
          <th>Issued By</th>
          <th>Approved By</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        {% for jo in jobOrders %}
          <tr>
            <td>{{ jo.job_order_number }}</td>
            {% if is_admin %}
              <td>{{ jo.performer.name }}</td>
            {% endif %}
            <td>{{ jo.client_name }}</td>
            <td>{{ jo.request_date | date("M d, Y") }}</td>
            <td>{{ jo.scheduled_start_date | date("M d, Y") }}-{{ jo.scheduled_end_date | date("M d, Y") }}</td>
            <td>{{ jo.issued_by }}</td>
            <td>{{ jo.approved_by }}</td>
            <td>{{ jo.status }}</td>
            <td class="flex">
              <div class="d-flex flex-no-wrap gap-1">
                {% if jo.status == 'Draft' %}
                  <a href="/form.php?edit={{ jo.job_order_id}}" class="btn btn-sm btn-primary">
                    <i class="fa-solid fa-pen"></i>
                  </a>
                {% else %}
                  <a href="/form.php?id={{ jo.job_order_id}}" class="btn btn-sm btn-success">
                    <i class="fa-solid fa-eye"></i>
                  </a>
                {% endif %}
                <a href="/form.php?delete={{ jo.job_order_id}}" class="btn btn-sm btn-danger">
                  <i class="fa-solid fa-trash"></i>
                </a>
              </div>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="999" class="!text-left">
              <em>No job orders found.</em>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div class="container">
  {{ knp_pagination_render(jobOrders) }}
</div>
{% endblock %}
